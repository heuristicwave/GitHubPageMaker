---
layout: post
current: post
navigation: True
title: Using Amazon ECS Exec for debugging
date: 2022-02-22 00:00:00
tags: [aws, devops]
class: post-template
subclass: 'post tag-aws'
author: HeuristicWave
---
Dockerì—ì„œëŠ” `exec` ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆì— ì ‘ì†í•˜ì—¬ ë””ë²„ê¹…ì´ ê°€ëŠ¥í•˜ë‹¤.
21ë…„ 3ì›” ë¶€í„° í•´ë‹¹ ê¸°ëŠ¥ì´ AWSì˜ ECSì—ì„œë„ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ ë˜ì—ˆëŠ”ë°, í•´ë‹¹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©° ë§Œë‚¬ë˜ ë¬¸ì œë“¤ì„ ê¸°ë¡.

## ğŸ“š References

- [Using Amazon ECS Exec for debugging](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-exec.html)
- [AWS CLI Cmd Ref : excute-commnad](https://docs.aws.amazon.com/cli/latest/reference/ecs/execute-command.html)

## Exec í™œì„±í™”

1. SSM ì—ì´ì „íŠ¸ì™€ SSM ì„œë¹„ìŠ¤ ê°„ì˜ í†µì‹ ì— í•„ìš”í•œ ê¶Œí•œ ë¶€ì—¬
2. task-definition config ì¶”ê°€
   ```shell
   "linuxParameters": {
       "initProcessEnabled": true
   }
   ```
3. CLIë¡œ execute-command enable í›„, ì ê²€
   ```shell
   aws ecs create-service \
    --cluster cluster-name \
    --task-definition task-definition-name \
    --enable-execute-command \
    --service-name service-name \
    --desired-count 1
   ```
   ì•„ë˜ ëª…ë ¹ì–´ë¡œ í™œì„±í™” ì—¬ë¶€ í™•ì¸. (grep option í™œìš©, `grep -F4 "managedAgents"`, `grep "enableExecuteCommand"`)
   ```shell
   aws ecs describe-tasks \
    --cluster cluster-name \
    --tasks task-id 
   ```
   í™œì„±í™” ìƒíƒœì¼ ë•Œì˜ Snippet
   ```shell
   {
       "tasks": [
           {
               ...
               "containers": [
                   {
                       ...
                       "managedAgents": [
                           {
                               "lastStartedAt": "2021-03-01T14:49:44.574000-06:00",
                               "name": "ExecuteCommandAgent",
                               "lastStatus": "RUNNING"
                           }
                       ]
                   }
               ],
               ...
               "enableExecuteCommand": true,
               ...
           }
       ]
   }
   ```
4. Running ECS Exec
   ```shell
   aws ecs execute-command --cluster cluster-name \
    --task task-id \
    --container container-name \
    --interactive \
    --command "/bin/sh"
   ```

<br>

## ë¬¸ì œ í•´ê²°

Exec ëª…ë ¹ì–´ ì´í›„ ì—ëŸ¬ í•¸ë“¤ (ê³µì‹ ë¬¸ì„œë“¤ì— ë‹µì´ ë‹¤ ìˆì—‡ë‹¤ ğŸ˜‚)
```shell
An error occurred (ClusterNotFoundException) when calling the ExecuteCommand operation: Cluster not found.
```

> Cluster ARN ê¸°ì… (From AWS CLI Ref : The Amazon Resource Name (ARN) or short name of the cluster from AWS CLI Ref)


```shell
SessionManagerPlugin is not found. Please refer to SessionManager Documentation here: http://docs.aws.amazon.com/console/systems-manager/session-manager-plugin-not-found
```

> í´ë¼ì´ì–¸íŠ¸ PCì— SSM Plugin ì„¤ì¹˜ (From AWS Docs : Prerequisites for using ECS Exec)


<br>

---

{% include ecs_troubleshooting.html %}

<br>