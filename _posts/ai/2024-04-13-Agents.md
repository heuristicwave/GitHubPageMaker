---
layout: post
current: post
cover: assets/built/images/background/langchain.svg
navigation: True
title: Create a Multi-Tool Agent with Cluade 3 and LangChain
date: 2024-04-13 00:00:00
tags: [ai, genai, llm]
class: post-template
subclass: "post tag-ai"
author: HeuristicWave
---

ReAct 2í¸ - Multi-Tool Agent ë§Œë“¤ê¸°

# <a href="#intro">Intro</a>

ì´ë²ˆ í¬ìŠ¤íŒ…ì€ [1í¸](https://heuristicwave.github.io/ReAct)ì—ì„œ ë¯¸ë¤˜ë˜ ReAct Agent ìƒì„±ì(Constructor) `create_react_agent`ì™€ ì—¬ëŸ¬ ê°œì˜ Taskë¥¼ ìˆ˜í–‰í•˜ëŠ” **Multi-Agents**ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

<br>

## <a href="#review-part-1">1ï¸âƒ£ 1í¸ ë³µìŠµ</a><a id="review-part-1"></a>

**â“ ë‹¤ìŒ Cluade 3ì™€ì˜ ì±„íŒ… í™”ë©´ì€ ê°€ëŠ¥í•œ ëŒ€í™”ì¸ê°€ìš”?**

![claude3](../../assets/built/images/post/ai/ReAct/datetime.png)

<details><summary markdown="span">âœ… ì •ë‹µ ë³´ê¸° Click ğŸ‘ˆ</summary>

ì •ë‹µì€ ê°€ëŠ¥í•  ìˆ˜ë„ ì•„ë‹ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ğŸ™„ ë¬´ìŠ¨ ë§ì´ëƒê³ ìš”?

ì½˜ì†” í™”ë©´ì—ì„œëŠ” ë¶ˆê°€ëŠ¥í•œ í™”ë©´ì´ì§€ë§Œ, Cluade APIë¥¼ í˜¸ì¶œí•œë‹¤ë©´, ê°€ëŠ¥í•œ ëŒ€í™”ì…ë‹ˆë‹¤.

ìœ„ ì‚¬ì§„ì—ì„œ ë³´ì´ëŠ”, í˜„ ì‹œê°„ì„ ì¸ì‹í•˜ëŠ” ê¸°ëŠ¥ê³¼ `Cluade 3`ì—ê²Œ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë˜í•œ, ìˆ˜í•™ ê³„ì‚° ëŠ¥ë ¥ë„ ë¶€ì¡±í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜, [ì§€ë‚œ 1í¸](https://heuristicwave.github.io/ReAct)ì—ì„œ ì´ì•¼ê¸°í•œ Toolsì„ í™œìš©í•œ ReAct ê¸°ë²•ì„ ì ìš©í•˜ë©´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

</details>

### `initialize_agent`, Built-in Tool & Custom Tool

ìœ„ ì±„íŒ… í™”ë©´ê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ìœ¼ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´, 2ê°œì˜ Toolì„ llmì— ì£¼ì…í•˜ë©´ êµ¬í˜„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

_ê¸°ì¡´ Built-in Tool `llm-math`ì— Custom Tool `time` ì¶”ê°€_

```python
from langchain.agents import load_tools, tool, initialize_agent, AgentType
from langchain_community.chat_models import BedrockChat
from datetime import datetime

chat = BedrockChat(
    model_id="anthropic.claude-3-sonnet-20240229-v1:0",
    model_kwargs={"max_tokens": 2048, "temperature": 0.1},
    region_name="us-west-2",
)

tools = load_tools(["llm-math"], llm=chat)

@tool
def time(text: str) -> str:
    """í˜„ì¬ ì‹œê°„ê³¼ ê´€ë ¨ëœ ì§ˆë¬¸ì— ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” í•­ìƒ ì˜¤ëŠ˜ì˜ ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤."""
    return str(datetime.now())

agent= initialize_agent(
    tools + [time],
    llm=chat,
    agent=AgentType.CHAT_ZERO_SHOT_REACT_DESCRIPTION,
    handle_parsing_errors=True,
    verbose = True
)

agent("ì§€ê¸ˆì€ ëª‡ ì¼ ëª‡ ì‹œì´ê³ , 19ì‹œ ë°œí‘œ ì˜ˆì •ì¸ ì €ì—ê²Œ ë°œí‘œ ìë£Œë¥¼ ë§Œë“¤ê¸°ê¹Œì§€ ë‚¨ì€ ì‹œê°„ì€ ëª‡ ì‹œê°„ ì¸ê°€ìš”?")
```

<br>

## <a href="#create-xxx-agent">2ï¸âƒ£ `create_XXX_agent`</a><a id="create-xxx-agent"></a>

ì´ë²ˆì—ëŠ” `initialize_agent` ìƒì„±ì ëŒ€ì‹ , ìƒˆë¡œìš´ ìƒì„±ìì¸ `create_react_agent` ìƒì„±ìë¥¼ ì‚¬ìš©í•´ Agentë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. urlì˜ ì •ë³´ë¥¼ ì½ì–´ë“¤ì—¬ ì§ˆë¬¸ì— ëŒ€í•˜ì—¬ `create_react_agent`ë¥¼ í™œìš©í•´ ì¶”ë¡ í•˜ëŠ” ê°„ë‹¨í•œ ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.

```python
url = [ "https://aws.amazon.com/ko/blogs/korea/introducing-aws-ambassador-program/" ]

@tool
def amb(text: str) -> str:
    """AWS Ambassadorì™€ ê´€ë ¨ëœ ì§ˆë¬¸ì— ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” í•œêµ­ì˜ Ambassador ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤."""
    loader = SeleniumURLLoader(urls=url)
    blog = loader.load()
    return blog[0].page_content

prompt = hub.pull("hwchase17/react")

agent= create_react_agent(llm=chat, tools=[amb], prompt=prompt)

agent_executor = AgentExecutor(agent=agent, tools=[amb], verbose=True)
result = agent_executor.invoke({"input": "í•œêµ­ì˜ AWS AmbassadorëŠ” ëª‡ ëª…ì¸ê°€ìš”?"})
```

### ğŸ ì¶”ë¡  ì¤‘ ë°œìƒí•˜ëŠ” ì´ìŠˆ

![claude3](../../assets/built/images/post/ai/ReAct/error01.png)

`create_react_agent`ë¥¼ ì‚¬ìš©í–ˆì„ ë•Œ, ë‹µì€ ì˜ ìƒì„±í•˜ì§€ë§Œ ì œëŒ€ë¡œ ëœ Custom Toolì„ ì‘ì„±í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ ,
_'xxx is not a valid tool,_ ê³¼ ê°™ì€ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì¶”ë¡ ì— ì´ìŠˆê°€ ë°œìƒí•©ë‹ˆë‹¤. ë¬¼ë¡ , ê²°ê³¼ì ìœ¼ë¡œ ë‹µë³€ì„ ì˜ ìƒì„±í•˜ì§€ë§Œ, ë‹¤ì–‘í•œ Taskë¥¼ ë¶€ì—¬í•œë‹¤ë©´ ì›í•˜ëŠ” ë‹µë³€ì„ ì–»ì§€ ëª»í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ Cluade ëª¨ë¸ì—ê²Œ ìµìˆ™í•œ `create_xml_agent` ìƒì„±ìë¥¼ ì‚¬ìš©í•´ ì—ì´ì „íŠ¸ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ğŸ¦œï¸ğŸ”— LangChain [XMLAgent ë¬¸ì„œ](https://python.langchain.com/docs/modules/agents/agent_types/xml_agent/)ì— _'Claudeì™€ ê°™ì€ ì¼ë¶€ ì–¸ì–´ ëª¨ë¸ì€ íŠ¹íˆ XML ì¶”ë¡ /ì‘ì„± ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.'_ ë¼ëŠ” ë‚´ìš©ì´ ê¸°ì¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

> ğŸ’¡ [Claude ëª¨ë¸ì€ XML tagsì— ìµìˆ™í•©ë‹ˆë‹¤.](https://docs.anthropic.com/claude/docs/use-xml-tags) <br> Claude is particularly familiar with prompts that have XML tags as Claude was exposed to such prompts during training. By wrapping key parts of your prompt (such as instructions, examples, or input data) in XML tags, you can help Claude better understand the context and generate more accurate outputs.

### `create_react_agent` vs `create_xml_agent`

ë™ì¼ ëª¨ë¸ë¡œ ìƒì„±í•œ ê²°ê³¼ë¥¼ í™•ì¸í•´ ë³´ë©´, xml ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ë©´ ë‹µë³€ì— ì¡°ê±´ì„ í¬í•¨í•´ ë” ë‚˜ì€ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤. _(í˜„ì¬ 11ëª…ì´ì§€ë§Œ, url ì‹œì ìœ¼ë¡œ í•œì •í•˜ì—¬ ì˜¬ë°”ë¥¸ ë‹µë³€ ìƒì„±)_

`create_react_agent`

```json
{
  "input": "í•œêµ­ì˜ AWS AmbassadorëŠ” ëª‡ ëª…ì¸ê°€ìš”?",
  "output": "í•œêµ­ì˜ AWS AmbassadorëŠ” í˜„ì¬ 10ëª…ì…ë‹ˆë‹¤."
}
```

`create_xml_agent`

```json
{
  "input": "í•œêµ­ì˜ AWS AmbassadorëŠ” ëª‡ ëª…ì¸ê°€ìš”?",
  "output": "2023ë…„ 5ì›” ê¸°ì¤€ìœ¼ë¡œ í•œêµ­ì—ëŠ” 10ëª…ì˜ AWS Ambassadorê°€ í™œë™í•˜ê³  ìˆìŠµë‹ˆë‹¤."
}
```

<br>

## <a href="#multi-tool-agent">3ï¸âƒ£ Multi-Tool Agent(ğŸ¦œï¸ğŸ”— Tool & Custom Tool)</a><a id="multi-tool-agent"></a>

ì´ë²ˆì—ëŠ” Built-in Toolì´ ì•„ë‹Œ `langchain_community`ì—ì„œ ì œê³µí•˜ëŠ” ë„êµ¬ì™€ ì¡°ê¸ˆ ë” ë³µì¡í•œ ì‘ì—…ì„ ì§€ì›í•˜ëŠ” Custom Toolì„ ì‚¬ìš©í•˜ì—¬ Multi-Tool Agentë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. _(PPTë¥¼ ë§Œë“¤ê¸° ìœ„í•´ Markdownì„ PPTë¡œ ë§Œë“œëŠ” `get_marp`ë¼ëŠ” Custom Toolì„ ì‚¬ì „ì— ì •ì˜í•´ ë‘ì—ˆìŠµë‹ˆë‹¤.)_

### ğŸ§­ GenAIë¡œ PPT ë§Œë“¤ê¸°

> 'AWSì—ì„œ ë°œí‘œí•˜ë ¤ í•©ë‹ˆë‹¤. AWSì— ëŒ€í•œ ìµœê·¼ ì •ë³´ë¥¼ duckduckgoì— ê²€ìƒ‰ í›„, `get_marp` toolì„ ì‚¬ìš©í•´ marp í˜•ì‹ìœ¼ë¡œ ë°œí‘œ ìë£Œë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.'

ìœ„ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒ 2ê°€ì§€ì˜ Taskë¥¼ Toolì´ ì§€ì›í•´ì•¼ í•©ë‹ˆë‹¤.

1. ìµœì‹  ìë£Œ ê²€ìƒ‰ : `langchain_community`ì˜ DuckDuckGO Tool í™œìš©
2. PPT ì œì‘ : MARPë¡œ PPTë¥¼ ìƒì„±í•˜ëŠ” Custom Tool í™œìš©

`create_xml_agent`ë¥¼ í™œìš©í•˜ì—¬ Multi-Tool Agentë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ `initialize_agent`ë¥¼ ì‚¬ìš©í•  ë•Œì™€ í¬ê²Œ ë‹¤ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.

```python
my_tools = [duckduckgo_tool] + [get_marp]
my_agent= create_xml_agent(llm=chat, tools=my_tools, prompt=prompt)
agent_executor = AgentExecutor(agent=my_agent, tools=my_tools)
```

> ğŸ‘¿ ì‹¤ì œ Agentì™€ Tool, Toolkitsì„ í†µí•©í•˜ë‹¤ ë³´ë©´, Type Casting ë¬¸ì œë¥¼ ë¹„ë¡¯í•˜ì—¬, ë” ë‚˜ì€ ì¶”ë¡  ê²°ê³¼ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ Prompt Engineeringì— êµ‰ì¥íˆ ë§ì€ ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤

### âœ”ï¸ ê²€ì¦

ì•„ë˜ ì¶”ë¡  ê³¼ì •ì„ ì‚´í´ë³´ë©´, *AWS ìµœê·¼ ì •ë³´ë¼ëŠ” Task*ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ Toolë¡œ DuckDuckGo Searchë¥¼ ì„ íƒí•˜ê³  ì ì ˆí•œ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•©ë‹ˆë‹¤. ì´ì–´ì„œ *ë°œí‘œ ìë£Œ ë§Œë“¤ê¸° Task*ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ `get_marp` Toolì„ í˜¸ì¶œí•´ ì˜ë„í•œ ëŒ€ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

![inference](../../assets/built/images/post/ai/ReAct/inference.png)

<details><summary markdown="span">âœ… ê²€ìƒ‰ ê²°ê³¼ ë¹„êµ Click ğŸ‘ˆ</summary>

ì‹¤ì œ duckduckgoì— 'AWS latest news'ë¡œ ê²€ìƒ‰í•œ í™”ë©´ê³¼ PPTë¥¼ ë§Œë“¤ê¸° ìœ„í•´ MARP í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•œ ë‚´ìš©ì´ ë™ì¼í•©ë‹ˆë‹¤.

```markdown
# AWS ìµœì‹  ë‰´ìŠ¤

## AWS Deadline Cloud ë°œí‘œ (2024ë…„ 4ì›” 2ì¼)

- ì™„ì „ ê´€ë¦¬í˜• ë Œë”ë§ ì„œë¹„ìŠ¤
- ë Œë”ë§ íŒŒì´í”„ë¼ì¸ íš¨ìœ¨ì„± í–¥ìƒ
- ë” ë§ì€ ì‘ì—… ì²˜ë¦¬ ê°€ëŠ¥

## NVIDIAì™€ AWS í†µí•© ê°•í™”

- ê³ ê° ì½”ë“œ ë° ë°ì´í„° ë³´ì•ˆ ê°•í™”
- ë…ë¦½ì ìœ¼ë¡œ NCC ê·¸ë£¹ì— ì˜í•´ ê²€ì¦ë¨

## re:Invent 2023 ì£¼ìš” ë°œí‘œ

- ìƒì„± AIê°€ ì£¼ìš” ê´€ì‹¬ì‚¬
- ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë“ì„ ìœ„í•œ í˜ì‹ 
- ë³´ì•ˆ, ì„ íƒ, ì„±ëŠ¥ í–¥ìƒ
- ë°ì´í„° ì •ë ¬ ë° ê±°ë²„ë„ŒìŠ¤ ì§€ì›
```

![duckduckgo](../../assets/built/images/post/ai/ReAct/duckduckgo.png)

</details>

<br>

## <a href="#outro">Outro</a>

1í¸ì„ ì‘ì„±í•˜ê³  2í¸ì´ ë‚˜ì˜¤ê¸°ê¹Œì§€ 2ë‹¬ì´ ê±¸ë ¸ìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ë‹¤ì§ì„ ê¸€ë¡œ ì ì–´ë‘ë‹ˆ, ëŒê³  ëŒì•„ ì‘ì„±í•˜ê²Œ ë˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë§¤ë²ˆ ê¸€ì“°ê¸°ëŠ” ê³ í†µìŠ¤ëŸ½ì§€ë§Œ, ì‘ì„±í•˜ê³  ë‚˜ë©´ ë¿Œë“¯í•˜ê¸°ì— 3í¸ì€ LangGraphì™€ Routingì— ëŒ€í•œ ë‚´ìš©ì„ ì•½ì†í•˜ë©° ì´ë²ˆ í¬ìŠ¤íŒ…ì„ ë§ˆë¬´ë¦¬ ì§“ê² ìŠµë‹ˆë‹¤.

ì†Œì¤‘í•œ ì‹œê°„ì„ ë‚´ì–´ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ì˜ëª»ëœ ë‚´ìš©ì€ ì§€ì í•´ì£¼ì„¸ìš”! ğŸ˜ƒ

---

{% include langchain.html %}
