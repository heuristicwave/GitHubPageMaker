---
layout: post
current: post
cover: assets/built/images/soap-bubble.jpg
navigation: True
title: Pipenv, Nginx, Gunicorn ì„œë²„ ìš´ì˜í•˜ê¸°
date: 2021-01-04 00:40:00
tags: [backend]
class: post-template
subclass: 'post tag-backend'
author: HeuristicWave
---

**Virtualenv** í™˜ê²½ì´ ì•„ë‹Œ **Pipenv**ë¥¼ ì‚¬ìš©í•˜ë©° ë§Œë‚œ ì—ëŸ¬ í•´ê²° ê³¼ì • ì •ë¦¬

<br>

### ì‚¬ì „ ì‘ì—…

*ìì„¸í•œ ë°©ë²•ì€ í•˜ë‹¨ ì°¸ê³ ìë£Œë¥¼ í†µí•´ í™•ì¸ í•  ìˆ˜ ìˆë‹¤*

1. gunicorn, nginx ì„¤ì¹˜

   > ec2ì—ì„œ nginx ì„¤ì¹˜í•˜ê¸° : [CentOS 7 Nginx ì„¤ì¹˜ ë°©ë²•](https://holjjack.tistory.com/114)

2. gunicorn ì‘ë™í™•ì¸

<br>

## Gunicorn ğŸ¦„

### ì„œë¹„ìŠ¤ ë“±ë¡ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±

`/etc/systemd/system/gunicorn.service` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì€ ë‚´ìš©ìœ¼ë¡œ ìƒì„±.
pipenvëŠ” venvì™€ **ExecStart** ê²½ë¡œê°€ ë‹¤ë¥´ë‹¤ëŠ” ì ì„ ìœ ë…í•´ ì‘ì„±í•˜ì

```
[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=ec2-user
Group=ec2-user
WorkingDirectory=/home/ec2-user/django/repo
ExecStart=/usr/local/bin/pipenv run gunicorn --workers 3 \
        <wsgiê°€ ìœ„ì¹˜í•œ í´ë”>.wsgi:application --bind 0.0.0.0:8000

[Install]
WantedBy=multi-user.target
```

> ë³¸ë˜ `--bind`ë¶€ë¶„ì— `unix:/home/ec2-user/django/gunicorn.sock` ë¥¼ ë„£ì–´ êµ¬ë™í•˜ë©´ repoì˜ ìƒìœ„ í´ë”ì—  `gunicorn.sock`ê°€ ìƒê¸´ë‹¤.
> <br>
> nginxì˜ proxy_pass ë¶€ë¶„ë„ `http://unix:/{$PATH}/gunicorn.sock`ì„ ê¸°ì¬í•´ sockë¡œ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ë§ëŠ” ë°©ë²• ê°™ì€ë°... ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” í•™ìŠµì´ í•„ìš”í•˜ë‹¤.

### ì„œë¹„ìŠ¤ ë“±ë¡

```shell
sudo systemctl start gunicorn
sudo systemctl enable gunicorn
```

### ì„œë¹„ìŠ¤ êµ¬ë™ í™•ì¸

```shell
sudo systemctl status gunicorn
```

<br>

## Nginx

### ì‚¬ì´íŠ¸ ì„¤ì • ì¶”ê°€

ec2ì— nginxë¥¼ ë°›ì•˜ì„ ë•Œ, `etc/nginx/sites-enabled` ì™€ `etc/nginx/sites-availabe` ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. í•´ë‹¹ ê²½ë¡œì— ì—†ë‹¤ë©´ ë§Œë“¤ì–´ì£¼ê³  ìˆìœ¼ë©´ default íŒŒì¼ì„ ì‚­ì œí•˜ì.

```
server {
        listen 80;
        server_name <IP or ë„ë©”ì¸>;
        charset utf-8;

        location / {
                include proxy_params;
                proxy_pass http://0.0.0.0:8000
        }

        location /static/ {
                root /home/ec2-user/django/repo;
        }
        
        location /media/ {
                root /home/ec2-user/django/repo;
        }
}
```

> [nginx ì£¼ìš” ê°œë…](https://velog.io/@yvvyoon/flask-nginx-gunicorn-1), nginx : [root vs alias](https://ohgyun.com/556)
> <br>
> `include proxy_params`ì˜ ê²½ìš° `/etc/nginx/proxy_params` ì— í”„ë¡ì‹œ í—¤ë”ë¥¼ ê¸°ì¬ í•´ì•¼ í•œë‹¤. (ë‹¤ìŒ ë§í¬ ì°¸ê³ ) 
> [nginx & aws](https://m.blog.naver.com/PostView.nhn?blogId=93immm&logNo=221304593384&proxyReferer=https:%2F%2Fwww.google.com%2F)

### ì‚¬ì´íŠ¸ ì¶”ê°€

```shell
sudo ln -s /etc/nginx/sites-available/django_test /etc/nginx/sites-enabled
```

### ê¸°ë™

```shell
sudo systemctl start nginx
```

<br>

#### ê¸°íƒ€ ë„ì›€ì´ ë˜ëŠ” ëª…ë ¹ì–´

```shell
sudo systemctl daemon-reload
sudo systemctl stop, restart nginx
ps -ef
ps
pkill gunicorn
```

<br>

<details><summary markdown="span">dotenv ê´€ë ¨ ì—ëŸ¬ í•´ê²°í•˜ê¸°</summary>

- gunicorn ì„ í™œìš©í•´ ì—°ê²° í•  ê²½ìš°

  ```sh
  $ pip uninstall dotenv
  $ pip install python-dotenv 
  ```
  
- docker + nginx + gunicorn ì„ í™œìš©í•  ê²½ìš°

  ```sh
  $ pip uninstall dotenv
  $ pip install python-dotenv 
  ```

</details>



<br>

<br>

---

#### ì°¸ê³ ìë£Œ

- gunicorn [ì‚¬ì „ì‘ì—…](https://wikidocs.net/6601#_7)
- [Nginx, Gunicorn, Django ì—°ë™í•˜ê¸°](https://velog.io/@y1andyu/Nginx-gunicorn-Django-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0#3-%EC%8B%9C%EC%9E%91)
