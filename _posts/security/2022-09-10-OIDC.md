---
layout: post
current: post
cover:  assets/built/images/background/OIDC.png
navigation: True
title: The Journey to Know OIDC
date: 2022-09-14 00:00:00
tags: [security]
class: post-template
subclass: 'post tag-backend'
author: HeuristicWave
---

Journey to OIDC through authentication, authorization, SAML, and OAuth.

<br>

## Intro

ìš”ì¦˜ ì œ ì¼ìƒì—ì„œ, OIDC(OpenID Connect)ì— ëŒ€í•´ ë§ì€ ì´ì•¼ê¸°ê°€ ì˜¤ê³  ê°”ìŠµë‹ˆë‹¤. ê·¸ë™ì•ˆ ë™ì‘ ì›ë¦¬ë„ ì œëŒ€ë¡œ ì•Œì§€ ëª»í•œ ì±„ ì‚¬ìš©í•˜ê³  ìˆë˜ ì œ ëª¨ìŠµì„ ë°˜ì„±í•˜ë©°,
OIDCë¥¼ ì•Œì•„ê°€ê¸° ìœ„í•´ ì¡°ì‚¬í•œ ë‚´ìš©ë“¤ì„ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.

<br>

## ğŸ¥¾ Authentication & Authorization

OIDCë¥¼ í–¥í•œ ì—¬ì •ì˜ ì²«ê±¸ìŒì€ ì¸ì¦ê³¼ ì¸ê°€ì…ë‹ˆë‹¤. êµ­ì–´ë¡œë„ ë¹„ìŠ·í•œ ë‘ ë‹¨ì–´ëŠ” ì˜ì–´ë¡œë„ ë¹„ìŠ·í•˜ë©° ë‹¤ìŒê³¼ ê°™ì´ ì¤„ì—¬ì„œ í‘œí˜„í•˜ê¸°ë„ í•©ë‹ˆë‹¤.
AuthN(ì¸ì¦) & AuthZ(ì¸ê°€, ê¶Œí•œ ë¶€ì—¬)

ì¸ì¦ê³¼ ì¸ê°€ì— ê´€í•œ ì„¤ëª…ì€ ì˜¨ë¼ì¸ì— êµ‰ì¥íˆ ë§ì§€ë§Œ, ì €ëŠ” ê·¸ì¤‘ì—ì„œë„ [**Auth0(ì˜¤ìŠ¤ì œë¡œ)** ì‚¬ì˜ ë¬¸ì„œì˜ ë¹„êµí‘œ](https://auth0.com/docs/get-started/identity-fundamentals/authentication-and-authorization#authentication-vs-authorization )ë¥¼ ì¸ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

|  Authentication | Authorization  |
|---|---|
| ì‚¬ìš©ìê°€ ìì‹ ì´ ì£¼ì¥í•˜ëŠ” ì‚¬ëŒì´ ë§ëŠ”ì§€ ê²°ì •í•©ë‹ˆë‹¤. | ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ ê²°ì •í•©ë‹ˆë‹¤. |
| ì‚¬ìš©ìì˜ ìê²© ì¦ëª…ì´ ìœ íš¨í•œì§€ í™•ì¸í•©ë‹ˆë‹¤. | ì •ì±…ê³¼ ë£°ì„ í†µí•´ ì ‘ê·¼ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. |
| í†µìƒ ì¸ê°€ ì „ ë‹¨ê³„ì— ì§„í–‰í•©ë‹ˆë‹¤. | í†µìƒ ì¸ì¦ ì´í›„ ë‹¨ê³„ì— ì§„í–‰í•©ë‹ˆë‹¤. |
| ì¼ë°˜ì ìœ¼ë¡œ **ID Token**ì„ í†µí•´ ì •ë³´ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. | ì¼ë°˜ì ìœ¼ë¡œ **Access Token**ì„ í†µí•´ ì •ë³´ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. |
| ì¼ë°˜ì ìœ¼ë¡œ **OIDC í”„ë¡œí† ì½œ**ì— ì˜í•´ ê´€ë¦¬ë©ë‹ˆë‹¤. | ì¼ë°˜ì ìœ¼ë¡œ **OAuth 2.0 í”„ë ˆì„ì›Œí¬**ì— ì˜í•´ ê´€ë¦¬ë©ë‹ˆë‹¤. |

> ğŸ’¡ ìœ„ ë¹„êµí‘œì— **Bold**ì²˜ë¦¬ëœ í‚¤ì›Œë“œê°€ ì˜¤ëŠ˜ í¬ìŠ¤íŒ…ì„ ì´í•´í•˜ê¸° ìœ„í•œ í•µì‹¬ ìš©ì–´ì´ë¯€ë¡œ ì£¼ëª©í•´ ì£¼ì„¸ìš”!

<br>

## â›° OAuth 2.0

**OAuth 2.0 Authorization Framework**ì˜ [RFC ë¬¸ì„œ](https://www.rfc-editor.org/rfc/rfc6749 )ì˜ Abstract ë¶€ë¶„ì„ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•©ë‹ˆë‹¤.
*"OAuth 2.0 ì¸ê°€ í”„ë ˆì„ì›Œí¬ëŠ” ì„œë“œíŒŒí‹° ì•±ë“¤ì´ ì œí•œëœ ê¶Œí•œì„ ì–»ëŠ” ê²ƒì„ ê°€ëŠ¥í•˜ê²Œ í•´ì¤ë‹ˆë‹¤."*

ì—¬ëŸ¬ë¶„ë“¤ì€ íŠ¹ì • ì„œë¹„ìŠ¤ íšŒì‚¬ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì´ìš©í•  ë•Œ, êµ¬ê¸€ì´ë‚˜ í˜ì´ìŠ¤ë¶ìœ¼ë¡œë¶€í„° íŠ¹ì • ê¶Œí•œì„ ë°›ì•„ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•œ ê²½í—˜ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤.
**êµ¬ê¸€ ê³„ì •** ì •ë³´ì˜ [ë‚´ ê³„ì •ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ì•±](https://myaccount.google.com/permissions )ì— ë“¤ì–´ê°€ í™•ì¸í•´ ë³´ì‹œë©´,
ë‚´ ê³„ì •ì´ ì–´ë–¤ ì•±ë“¤ì´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ ê¶Œí•œì„ ì£¼ì—ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.

![OAuth 2.0](../../assets/built/images/post/security/oauth.png)

ìœ„ ì‚¬ì§„ì„ í†µí•´, êµ¬ê¸€ì´ **OAuth í”„ë ˆì„ì›Œí¬**ë¥¼ ì‚¬ìš©í•´ Meetup, Notion, Slackê³¼ ê°™ì€ **ì„œë“œíŒŒí‹° ì•±**ë“¤ì—ê²Œ
ê³„ì •ì˜ ì´ë©”ì¼ ì£¼ì†Œ í™•ì¸, ê°œì¸ì •ë³´ ë³´ê¸° ë“±ê³¼ ê°™ì€ **ì œí•œëœ ê¶Œí•œ**ì— ëŒ€í•˜ì—¬ **ì¸ê°€**ë¥¼ í•´ì¤¬ë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Slackìœ¼ë¡œ ì•Œì•„ë³´ëŠ” OAuth 2.0 Flow

OAuthì— ì›Œí¬í”Œë¡œë¥¼ ì•Œì•„ë³´ê¸° ì „ì—, ìì£¼ ì–¸ê¸‰ë˜ëŠ” í•µì‹¬ ìš©ì–´ë“¤ì„ ì–¸ê¸‰í•˜ê³  ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.

- Client : ì¸ê°€ë¥¼ ë°›ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ (ë°°ë‹¬ì˜ ë¯¼ì¡±, ì•¼ë†€ì, ì˜¤ëŠ˜ì˜ ì§‘ ë“±)
- Resource Server : ì œì–´í•˜ê³ ì í•˜ëŠ” ìì›(Protected Resource)ì„ ê°€ì§„ ì„œë²„ (êµ¬ê¸€, í˜ì´ìŠ¤ë¶, ê¹ƒí—™)
- Resource Owner : ìì›ì˜ ì†Œìœ ì (end-user)
- Authorization Server : AuthZ ì²˜ë¦¬ë¥¼ í•˜ëŠ” ì„œë²„

ë‹¤ì‹œ [RFC ë¬¸ì„œ](https://www.rfc-editor.org/rfc/rfc6749 )ë¡œ ëŒì•„ì™€ì„œ í•´ë‹¹ í”„ë¡œí† ì½œì˜ Flowë¥¼ ì•ì„œ ë³´ì—¬ë“œë¦° ì˜ˆì‹œì²˜ëŸ¼ ìš°ë¦¬ì˜ ê²½í—˜ì— ë¹—ëŒ€ì–´ ì„¤ëª…í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```shell
# Abstract Protocol Flow
+--------+                               +---------------+
|        |--(A)- Authorization Request ->|   Resource    |
|        |                               |     Owner     |
|        |<-(B)-- Authorization Grant ---|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |--(C)-- Authorization Grant -->| Authorization |
| Client |                               |     Server    |
|        |<-(D)----- Access Token -------|               |
|        |                               +---------------+
|        |
|        |                               +---------------+
|        |--(E)----- Access Token ------>|    Resource   |
|        |                               |     Server    |
|        |<-(F)--- Protected Resource ---|               |
+--------+                               +---------------+
```

ìš°ì„  A & Bì— í•´ë‹¹í•˜ëŠ” Clientê°€ Resource Ownerì—ê²Œ AuthZë¥¼ ìš”ì²­í•˜ê³  ìŠ¹ì¸ ì ˆì°¨ë¥¼ Slack ë¡œê·¸ì¸ì„ í†µí•´ì„œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

![login](../../assets/built/images/post/security/googleOAuth.png)

ìœ„ ì´ë¯¸ì§€ì—ì„œ Clientì¸ slackì€ Googleê³¼ Apple 2ê°€ì§€ ë°©ì‹ì˜ OAuthë¥¼ ì œê³µí•©ë‹ˆë‹¤.
'Googleë¡œ ê³„ì†'ì´ë¼ëŠ” ë²„íŠ¼(A ë‹¨ê³„, AuthZ ìš”ì²­)ì„ ëˆ„ë¥´ë©´, slackì´ ê³„ì •ì˜ ì´ë¦„, ì´ë©”ì¼, í”„ë¡œí•„ ì‚¬ì§„ ë“±ì˜ ì •ë³´ ê³µìœ ë¥¼ ìš”ì²­í–ˆë‹¤ëŠ” ê²ƒì„ êµ¬ê¸€ì˜ Authorization Serverë¡œë¶€í„° ë°›ìŠµë‹ˆë‹¤.
í•´ë‹¹ ì‹œì ì˜ ì›¹ë¸Œë¼ìš°ì € URIë¥¼ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. *(í¸ì˜ìƒ URIì„ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ê³ , Decode í•˜ì—¬ í‘œê¸°í–ˆìŠµë‹ˆë‹¤.)*

```shell
https://accounts.google.com/o/oauth2/v2/auth/oauthchooseaccount? \ 
  client_id=6XXXXXXXX.apps.googleusercontent.com& \
  redirect_uri=https://oauth2.slack.com/get-started/oauth/google/end& \
  scope=openid email profile& \
  response_type=code& \
  access_type=offline& \
  state=& \
  prompt=consent& \
  flowName=GeneralOAuthFlow
```

ìŠ¬ë™ì˜ ê¶Œí•œ ë¶€ì—¬ì˜ ê²½ìš°, `https://accounts.google.com/{ì´í•˜ ìƒëµ}`ì´ë¼ëŠ” Authorization Serverì˜ ì£¼ì†Œì™€ `client_id`ë¥¼ í¬í•¨í•œ 8ê°œì˜ querystringìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ì—¬ê¸°ì„œ ìƒìœ„ 4ê°œì˜ querystringì€ ì¸ê°€ë¥¼ ìœ„í•œ **í•„ìˆ˜ íŒŒë¼ë¯¸í„°**ì…ë‹ˆë‹¤.

- `client_id` : clientë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ Register ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹ë³„ì
- `redirect_uri` : authorization codeë¥¼ ì „ë‹¬ë°›ì„ client ì„œë²„ì˜ URI
- `scope` : ì¸ê°€í•  ê¶Œí•œì„ ëª…ì‹œ
- `response_type` : code, token ë“± OAuthì— ì ìš©í•  ë°©ì‹ì˜ íƒ€ì…

### Implicit Grant Flow

ìº¡ì²˜í™”ë©´ì—ì„œëŠ” ìš°ë¦¬ì˜ ì›¹ ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ Aì™€ Bì˜ ë‹¨ê³„ê°€ í´ë¦­ 2ë²ˆìœ¼ë¡œ ëë‚˜ì§€ë§Œ, ì‚¬ì‹¤ Aì™€ B ì‚¬ì´ì—ëŠ” ë” ë³µì¡í•œ ë‹¨ê³„ë“¤ì´ ìˆ¨ê²¨ì ¸ ìˆìŠµë‹ˆë‹¤.
ì•„ë˜ RFC ë¬¸ì„œì— ê¸°ì¬ëœ **Implicit Grant Flow**ë¥¼ ì‚´í´ë³´ë©° A ì´í›„ì˜ ë‹¨ê³„ë“¤ì„ ì‚´ì§ ë³´ê³  ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤. ğŸ«£ 

```shell
 +----------+
 | Resource |
 |  Owner   |
 |          |
 +----------+
      ^
      |
     (B)
 +----|-----+          Client Identifier     +---------------+
 |         -+----(A)-- & Redirection URI --->|               |
 |  User-   |                                | Authorization |
 |  Agent  -|----(B)-- User authenticates -->|     Server    |
 |          |                                |               |
 |          |<---(C)--- Redirection URI ----<|               |
 |          |          with Access Token     +---------------+
 |          |            in Fragment
 |          |                                +---------------+
 |          |----(D)--- Redirection URI ---->|   Web-Hosted  |
 |          |          without Fragment      |     Client    |
 |          |                                |    Resource   |
 |     (F)  |<---(E)------- Script ---------<|               |
 |          |                                +---------------+
 +-|--------+
   |    |
  (A)  (G) Access Token
   |    |
   ^    v
 +---------+
 |         |
 |  Client |
 |         |
 +---------+
```

ê°„ëµí•˜ê²Œ ëª‡ ê°€ì§€ë¥¼ ë” ì„¤ëª…í•˜ìë©´, ìœ„ ìŠ¹ì¸ Flowì˜ User-AgentëŠ” ìš°ë¦¬ì˜ ì›¹ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.
ë¸Œë¼ìš°ì €ëŠ” ì¸ê°€ ì„œë²„ì˜ URIì— querystringìœ¼ë¡œ `client_id`ì™€ `redirect_uri`ë¥¼ ë¶™ì—¬ ì¸ê°€ ì„œë²„ì— ì „ë‹¬í•˜ë©´(A),
ì¸ê°€ ì„œë²„ëŠ” **ê²€ì¦** ì‘ì—…ì„ ê±°ì³ **Access Token**ì„ ë°œê¸‰(C) í•©ë‹ˆë‹¤.
ì´í›„ ClientëŠ” ìƒì„±ëœ **Access Token**ì„ í™œìš©í•´ scopeì— ëª…ì‹œëœ ê¸°ëŠ¥ì„ Resource Serverë¡œë¶€í„° ì œê³µë°›ìŠµë‹ˆë‹¤.(ìœ„ ê·¸ë¦¼, Implicit Grant Flowì—ì„œëŠ” ë‚˜ì˜¤ì§€ ì•ŠìŒ)
í•´ë‹¹ ì ˆì°¨ê°€ `Abstract Protocol Flow` ê·¸ë¦¼ì˜ B ~ Fì— í•´ë‹¹í•©ë‹ˆë‹¤.

### Authorization Code Grant

ì‚¬ì‹¤, Implicit Grant Flowì˜ **C ë‹¨ê³„**ì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ì¸ê°€ ì½”ë“œ ë°œê¸‰ ê³¼ì •ì´ ìƒëµë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```shell
+----------+
| Resource |
|   Owner  |
|          |
+----------+
     ^
     |
    (B)
+----|-----+          Client Identifier      +---------------+
|         -+----(A)-- & Redirection URI ---->|               |
|  User-   |                                 | Authorization |
|  Agent  -+----(B)-- User authenticates --->|     Server    |
|          |                                 |               |
|         -+----(C)-- Authorization Code ---<|               |
+-|----|---+                                 +---------------+
  |    |                                         ^      v
 (A)  (C)                                        |      |
  |    |                                         |      |
  ^    v                                         |      |
+---------+                                      |      |
|         |>---(D)-- Authorization Code ---------'      |
|  Client |          & Redirection URI                  |
|         |                                             |
|         |<---(E)----- Access Token -------------------'
+---------+       (w/ Optional Refresh Token)
```
ë¸Œë¼ìš°ì €ëŠ” ì¸ê°€ ì„œë²„ì˜ URIì— querystringìœ¼ë¡œ `client_id`ì™€ `redirect_uri`ë¥¼ ë¶™ì—¬ ì¸ê°€ ì„œë²„ì— ì „ë‹¬(A) í•˜ëŠ” ê²ƒì€ ë™ì¼í•©ë‹ˆë‹¤.
ì´ì–´ì„œ ì¸ê°€ ì„œë²„ëŠ” **ê²€ì¦** ì‘ì—…ì„ ê±°ì³ **Authorization Code**ì„ ë°œê¸‰(C) í•©ë‹ˆë‹¤.
**Authorization Code**ë¥¼ ë°›ì€ ë¸Œë¼ìš°ì €ëŠ” Clientì—ê²Œ ì „ë‹¬(C) í•˜ê³ , ClientëŠ” ë‹¤ì‹œ ì¸ê°€ ì„œë²„ì—ê²Œ Codeë¥¼ ë³´ë‚´ê³ (D)
Access Tokenì„ ëŒë ¤ë°›ìŠµë‹ˆë‹¤.

ì§€ê¸ˆê¹Œì§€ ìƒì†Œí•œ ì •ë³´ë“¤ì„ ìŸì•„ë‚´ë‹¤ ë³´ë‹ˆ, ë…ì ì—¬ë ¤ë¶„ë“¤ì´ êµ‰ì¥íˆ í˜¼ë€ìŠ¤ëŸ¬ìš¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. (ì²˜ìŒ OAuthë¥¼ ê³µë¶€í–ˆë˜ ì œê°€ ê·¸ë¬ìŠµë‹ˆë‹¤ ğŸ˜µâ€ğŸ’«)
ì²˜ìŒë¶€í„° ëª¨ë“  ê³¼ì •ì„ ì´í•´í•˜ë ¤ í•˜ë©´ ì–´ë ¤ìš°ë‹ˆ, ëŒ€ëµì ì¸ íë¦„ë§Œ íŒŒì•…í•˜ê³  ë„˜ì–´ê°€ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤. ì´í›„ OIDCì—ì„œ ì˜ˆì‹œì™€ í•¨ê»˜ ë˜ ë‹¤ë£° ì˜ˆì •ì´ê±°ë“ ìš” ğŸ™ƒ
 
> ğŸ› ìœ„ 2ê°€ì§€ Flowê°€ OAuth 2.0ì˜ ì „ì²´ FlowëŠ” ì•„ë‹™ë‹ˆë‹¤. Client Register, Refresh Token ë“± **ì¤‘ìš” ê°œë…ë“¤ì´ ìƒë‹¹íˆ ìƒëµ** ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

<br>

## OpenID Connect(OIDC)

ì–¼ë ëš±ë•… OAuthë¥¼ ë„˜ê¸°ê³  ë“œë””ì–´ OpenID Connect ìˆœì„œì— ë‹¤ ë‹¤ë¥´ì—ˆìŠµë‹ˆë‹¤. OIDCë¥¼ ë‹¤ë£¨ê¸° ì „, **OpenID**ê°€ ë¬´ì—‡ì¸ì§€ [OpenID ì¬ë‹¨ì˜ ì„¤ëª…](https://openid.net/what-is-openid/ )ì—ì„œ ëª‡ ê°€ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

### OpenID

- OpenIDëŠ” ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë§Œë“¤ í•„ìš” ì—†ì´, ê¸°ì¡´ ê³„ì •ì„ ì‚¬ìš©í•´ ì—¬ëŸ¬ ì›¹ì‚¬ì´íŠ¸ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- OpenIDë¥¼ ì‚¬ìš©í•˜ë©´ ì›¹ì‚¬ì´íŠ¸ì™€ ê³µìœ ë˜ëŠ” ì •ë³´ì˜ ì–‘ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë‹¹ì‹ ì˜ ë¹„ë°€ë²ˆí˜¸ì€ Identity provider(Idp)ì—ê²Œë§Œ ì£¼ì–´ì§€ë©°, Idpê°€ ì‹ ì›ì„ í™•ì¸í•˜ë¯€ë¡œ ì•ˆì „í•˜ì§€ ì•Šì€ ì›¹ì‚¬ì´íŠ¸ê°€ ë‹¹ì‹ ì˜ ì‹ ì›ì„ í›¼ì†í•˜ëŠ” ê²ƒì— ëŒ€í•´ ê±±ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

> âš¡ï¸ OpenID 2.0ì€ OpenID Connectë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤. [Ref. Libraries for Obsolete Specifications](https://openid.net/developers/libraries/obsolete/)

### Using OAuth 2.0 to Access APIs

ì´ì–´ì„œ, [OpenID ì¬ë‹¨ì˜ ì„¤ëª…](https://openid.net/connect/ )ì˜ OIDCëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
"OpenID Connect 1.0 is a simple identity layer on top of the OAuth 2.0 protocol." OIDCê°€ OAuth í”„ë¡œí† ì½œì˜ ìƒìœ„ ê°„ë‹¨í•œ ì‹ ì› ê³„ì¸µì´ë¼ëŠ” ë§ì´ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œìš”?
ì—¬ê¸°ì„œ ì•ì„œ slack ì˜ˆì‹œì—ì„œ ë§Œë‚œ OAuthì˜ `scope` ë¶€ë¶„ìœ¼ë¡œ ê±°ìŠ¬ëŸ¬ ì˜¬ë¼ê°€ ë³´ê² ìŠµë‹ˆë‹¤. (`scope=openid email profile`) í•´ë‹¹ íŒŒë¼ë¯¸í„°ì—ëŠ” ì¸ê°€í•  ë¦¬ì†ŒìŠ¤ê°€ `openid`ë¡œ ê¸°ì¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ì¦‰, slackì€ ì œ í”„ë¡œí•„ ì •ë³´ë¥¼ ì–»ê¸° ìœ„í•´ **OAuth 2.0**ì„ ì‚¬ìš©í•´ `Google OAuth2 API v2`ë¥¼ í˜¸ì¶œí–ˆê³ , ì•¡ì„¸ìŠ¤í•˜ë ¤ëŠ” APIì˜ `scope`ì„ `openid`ë¡œ ì§€ì •í–ˆìŠµë‹ˆë‹¤. 

ì´í•´ë¥¼ ë•ê¸° ìœ„í•´, Google Developersì˜ [OAuth 2.0 Playground](https://developers.google.com/oauthplayground/ )(Clientë¥¼ êµ¬ì¶•í•  í•„ìš” ì—†ì´, ë°ëª¨ í™˜ê²½ì„ ì œê³µ)ë¥¼ ì‚¬ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.

![playground](../../assets/built/images/post/security/playgroundOAuth.png)

Step1ì—ì„œ `Google OAuth2 API v2`ì˜ `scope`ìœ¼ë¡œ `email`, `profile`, `openid`ë¥¼ ì§€ì •í•˜ê³  Authorize APIs ë²„íŠ¼ì„ ëˆ„ë¥´ë‹ˆ,
Clientë§Œ Google OAuth 2.0 Playgroundë¡œ ë°”ë€Œê³  slack ì˜ˆì‹œì™€ ë™ì¼í•œ ê²°ê³¼ë¥¼ ë°›ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ™ˆ í•´ë‹¹ URIë„ ì£¼ì˜ ê¹Šê²Œ ì‚´í´ë³´ë©´ paramterì˜ ìˆœì„œë§Œ ë‹¤ë¥¼ ë¿, í•„ìˆ˜ íŒŒë¼ë¯¸í„°ë¥¼ í¬í•¨í•˜ì—¬ slack ì˜ˆì‹œì™€ ë¹„ìŠ·í•œ URIë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Step2ì—ì„œëŠ” Idp(ì—¬ê¸°ì„œëŠ” êµ¬ê¸€ì˜ ì¸ì¦ ì„œë²„)ë¡œë¶€í„° ë°œê¸‰ëœ **Authorization code**ë¥¼ í† í°ìœ¼ë¡œ ë°”ê¾¸ëŠ” **Exchange authorization code for tokens** ë²„íŠ¼ì„ ëˆ„ë¥´ë©´,
**Refresh token**ê³¼ **Access token** Idpë¡œë¶€í„° ë°›ì•„ Playground ì›¹ í˜ì´ì§€ì— ë‚˜íƒ€ë‚˜ê²Œ ë©ë‹ˆë‹¤.

![step2](../../assets/built/images/post/security/OAuthStep2.png)

ì´ì–´ì„œ ì „ë‹¬ëœ Response ê°’ì„ í™•ì¸í•´ ë³´ë©´, íƒ€ OAuth 2.0 APIë¥¼ `scope`ìœ¼ë¡œ ì„ íƒí–ˆì„ ë•Œì™€ëŠ” ë‹¤ë¥´ê²Œ `id_token` ê°’ìœ¼ë¡œ JWT í˜•íƒœì˜ ê°’ì„ ë°›ìŠµë‹ˆë‹¤.

### id_token

OIDCëŠ” OAuth 2.0ì˜ ìƒìœ„ ê³„ì¸µì´ë¯€ë¡œ ë™ì‘ ì›ë¦¬ê°€ OAuth 2.0ê³¼ ë™ì¼í•©ë‹ˆë‹¤. í•œ ê°€ì§€ ë‹¤ë¥¸ ì ì€, `id_token` ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
Step2ì—ì„œ ë°›ì€ `id_token` ê°’ì„ [jwt.io](https://jwt.io/ )ì— ë³µì‚¬í•˜ì—¬ Decode í•œ ì •ë³´ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

![jwt](../../assets/built/images/post/security/jwt.png)

jwtëŠ” `.`ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ decode í•˜ë©´ ì•„ë˜ 3ê°€ì§€ í•„ë“œë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

- header : id í† í°ì˜ í˜•ì‹, í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ì˜ ì¢…ë¥˜, ì•”í˜¸í™”ì— ì‚¬ìš©ëœ ê³µê°œí‚¤ ID
- payload : ì‚¬ìš©ì ì¸ì¦ ì •ë³´ - (ë°œê¸‰ ê¸°ê´€, í† í°ì´ ë°œê¸‰ëœ ì•±, id í† í° ìœ ì €ì˜ ë²ˆí˜¸, ë°œê¸‰ ì‹œê°„, ë§Œë£Œ ì‹œê°„, ì´ë©”ì¼, ì´ë¦„, í”„ë¡œí•„ ì‚¬ì§„ ë“±) 
- signature : ì¸ì¦ ì„œë²„ì— headerì˜ ê³µê°œí‚¤ë¡œ ì„œëª…í•œ ê°’

clientëŠ” payloadì— ë‹´ê¸´ ì‚¬ìš©ì ì •ë³´ë¥¼ í™œìš©í•´ ìœ ì €ì˜ ì¸ì¦ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Recap

ì—¬ê¸°ê¹Œì§€ í¬ìŠ¤íŒ…ì„ ì½ìœ¼ì…¨ë‹¤ë©´, ì•ë¶€ë¶„ì— ì–¸ê¸‰í–ˆë˜ **Auth0(ì˜¤ìŠ¤ì œë¡œ)**ì˜ ì¸ì¦, ì¸ê°€ ë¹„êµí‘œë¥¼ ë– ì˜¬ë ¤ì£¼ì„¸ìš”.
**OAuth**ëŠ” **AuthZ(ì¸ê°€)**ì— ì´ˆì ì´ ë§ì¶° ì € **Access Token**ìœ¼ë¡œ íŠ¹ì • ê¶Œí•œì„ í—ˆê°€í•´ ì¤„ ë¿ ì‚¬ìš©ìì˜ ì •ë³´ëŠ” ë‹´ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.
ë°˜ë©´, OIDCëŠ” **ID Token**ì„ í†µí•´ ì •ë³´ë¥¼ ì „ì†¡í•˜ë©° **AuthN(ì¸ì¦)**ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ì˜€ìŠµë‹ˆë‹¤.

<br>

## Outro

ì´ë²ˆ í¬ìŠ¤íŒ…ì€ ê¸°ì¡´ì— ì˜¬ë¦° íƒ€ ê¸€ë“¤ë³´ë‹¤ ë§ì€ ë ˆí¼ëŸ°ìŠ¤ ë¬¸ì„œë“¤ì„ ì½ì—ˆìŠµë‹ˆë‹¤. ì´ë¯¸ ì˜¨ë¼ì¸ì— êµ‰ì¥íˆ ì˜ ì •ë¦¬ëœ ì½˜í…ì¸ ë“¤ì´ ë§ì§€ë§Œ,
ì œ ë‚˜ë¦„ëŒ€ë¡œ ì¬ê°€ê³µ í•˜ë‹¤ ë³´ë‹ˆ ë¶€ì¡±í•œ ë¶€ë¶„ë“¤ì´ ë§ìŠµë‹ˆë‹¤. ì œê²Œ ë§ì€ ë„ì›€ì´ ë˜ì—ˆë˜ ë ˆí¼ëŸ°ìŠ¤ë“¤ì„ ì•„ë˜ ì²¨ë¶€í•˜ë‹ˆ, í•¨ê»˜ ë³´ì‹œë©´ ë„ì›€ì´ ë§ì´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ, [Samsung SDSì˜ ì¸ì‚¬ì´íŠ¸ ë¦¬í¬íŠ¸](https://www.samsungsds.com/kr/insights/oidc.html )ì—
ì‹¤ë¦° ìš”ì•½ì´ ì˜¤ëŠ˜ì˜ ì •ë³´ë“¤ì„ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•´ ì£¼ëŠ” ê²ƒ ê°™ì•„ í•¨ê»˜ ì²¨ë¶€í•˜ë©° ë§ˆì¹˜ê² ìŠµë‹ˆë‹¤. (ìš”ì•½ëœ ë¬¸ì¥ì˜ ë‹¨ì–´ í•˜ë‚˜í•˜ë‚˜ê°€ í•´ë‹¹ ê¸°ìˆ ì˜ íŠ¹ì§•ì„ ì˜ ë‚˜íƒœë‚¸ë‹¤ëŠ” ìƒê°ì´ ë“œë„¤ìš” ğŸ˜Š)

- SAML 2.0 : 2001ë…„ OASISì—ì„œ ì •ì˜í•œ ê°œë°©í˜• Authentication(ì¸ì¦) ë° Authorization(ì¸ê°€) í‘œì¤€ì´ë©°, ì—”í„°í”„ë¼ì´ì¦ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ SSO(Single Sign On)ë¥¼ ëª©ì ìœ¼ë¡œ XML(Extensible Markup Language) í˜•ì‹ìœ¼ë¡œ ê°œë°œ
- OAuth 2.0 : 2006ë…„ Twitterì™€ Googleì´ ì •ì˜í•œ ê°œë°©í˜• Authorization í‘œì¤€ì´ë©°, API í—ˆê°€ë¥¼ ëª©ì ìœ¼ë¡œ JSON(Javascript Object Notation) í˜•ì‹ìœ¼ë¡œ ê°œë°œ
- OIDC 2.0 : 2014ë…„ OpenID Foundationì—ì„œ ì •ì˜í•œ ê°œë°©í˜• Authentication í‘œì¤€ì´ë©°, ì»¨ìŠˆë¨¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ SSOë¥¼ ëª©ì ìœ¼ë¡œ JSON í˜•ì‹ìœ¼ë¡œ ê°œë°œ

ì†Œì¤‘í•œ ì‹œê°„ì„ ë‚´ì–´ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! íŠ¹íˆë‚˜ ì´ë²ˆ í¬ìŠ¤íŒ…ì€ ì˜ëª»ëœ ë‚´ìš© í˜¹ì€ ë¶€ì ì ˆí•œ ì„¤ëª…ì´ ìˆì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ììœ ë¡­ê²Œ ì§€ì í•´ ì£¼ì„¸ìš”!
ë²Œì¨ í¬ìŠ¤íŒ… ì´í›„ 3ë²ˆì´ë‚˜ ë‹¤ì‹œ ë°°í¬í•˜ê²Œ ë˜ì—ˆë„¤ìš”. ğŸ˜ƒ

<br>

## ğŸ“š References

### SSO(SAML & OAuth 2.0)

- [SAML vs. OAuth: Comparison and Differences](https://www.okta.com/identity-101/saml-vs-oauth/) : SAML, OAuth 2.0 ë™ì‘ ì›ë¦¬ ì„¤ëª…
- [NAVER WORKS Developers, SSO ê°œìš”](https://developers.worksmobile.com/kr/document/2001001?lang=ko) : ë„¤ì´ë²„ ì›ìŠ¤ì—ì„œ SAML, OAuth 2.0 êµ¬í˜„ ë°©ë²• ì†Œê°œ
- [OASIS, SAML V2.0 Technical Overview](https://www.oasis-open.org/committees/download.php/27819/sstc-saml-tech-overview-2.0-cd-02.pdf)

### OAuth 2.0

- [OAuth 2.0 RFC](https://www.ietf.org/rfc/rfc6750.txt)
- [ìƒí™œì½”ë”©, WEB2 - OAuth 2.0](https://opentutorials.org/course/3405)

### OIDC

- [Samsung SDS, í¸ì˜ì„±ì„ ë†’ì¸ ID ì¸ì¦ ê´€ë¦¬ - OIDC(OpenID Connect)ê°€ ì£¼ëª© ë°›ëŠ” ì´ìœ ](https://www.samsungsds.com/kr/insights/oidc.html)
- [kakao developers, OIDC](https://developers.kakao.com/docs/latest/ko/kakaologin/common#oidc)
- [OpenID Connect Spec](https://openid.net/specs/openid-connect-core-1_0.html)
- [DaleSeo, êµ¬ê¸€ OpenID Connect ì‚¬ìš©ë²•](https://www.daleseo.com/google-oidc/) : ì‹¤ìŠµ ì½”ë“œ ì œê³µ
- [k8s ì¸ì¦ ì™„ë²½ì´í•´ #3 - OpenID Connect](https://coffeewhale.com/kubernetes/authentication/oidc/2020/05/04/auth03/) : ì¿ ë²„ë„¤í‹°ìŠ¤ ì¸ì¦ì„ ì„¤ëª…í•˜ëŠ” ê¸€ì´ì§€ë§Œ, OIDCë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ì•„ì£¼ ì¢‹ì€ ê¸€

### Hands-On

- [OAuth 2.0 Playground](https://developers.google.com/oauthplayground/)
- [jwt.io](https://jwt.io/) : jwt í† í° Decode
- [Github Docs, Building OAuth App](https://docs.github.com/en/developers/apps/building-oauth-apps/creating-an-oauth-app)
- [passportjs](https://www.passportjs.org/concepts/authentication/oauth/)

### ê¸°íƒ€ ë„ì›€ì´ ë˜ëŠ” ì½˜í…ì¸ 

- [ì–„íŒí•œ ì½”ë”©ì‚¬ì „, ì„¸ì…˜ VS í† í°! JWTê°€ ë­”ê°€ìš”?](https://youtu.be/1QiOXWEbqYQ) : ë°°ê²½ ì§€ì‹ì´ ì—†ë‹¤ë©´, ì´ ì˜ìƒ ë¨¼ì € ë³´ëŠ” ê²ƒì„ ì¶”ì²œ
- [okta, Whatâ€™s the Difference Between OAuth, OpenID Connect, and SAML?](https://www.okta.com/identity-101/whats-the-difference-between-oauth-openid-connect-and-saml/)

---
